name: Documentation Linting with Reusable Action
on: 
  pull_request:
    paths: ['docs/**']
  workflow_dispatch:

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  lint-documentation:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        section: [section1, section2, section3, section4]
      fail-fast: false
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Lint ${{ matrix.section }} documentation
        id: lint
        uses: ./.github/actions/markdown-linter
        with:
          directory: 'docs/${{ matrix.section }}'
          comment-title: 'ğŸ“– Linting Results - ${{ matrix.section }}'
          files-pattern: '**/*.md'
          fail-on-error: 'false'

      - name: Display results
        run: |
          echo "ğŸ“Š Linting completed for docs/${{ matrix.section }}"
          echo "Has errors: ${{ steps.lint.outputs.has-errors }}"
          echo "Results file: ${{ steps.lint.outputs.results-file }}"
          echo "Comment ID: ${{ steps.lint.outputs.comment-id }}"

  # Optional: Summary job that consolidates results
  lint-summary:
    needs: lint-documentation
    runs-on: ubuntu-latest
    if: always()
    
    steps:
      - name: Checkout for summary
        uses: actions/checkout@v4
        
      - name: Create workflow summary
        uses: peter-evans/create-or-update-comment@v5
        with:
          token: ${{ github.token }}
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            ## ğŸ¯ Documentation Linting Summary
            
            Markdown linting has been completed for all documentation sections using our reusable action!
            
            ### Processed Sections:
            - ğŸ“ **section1** â†’ `docs/section1`
            - ğŸ“ **section2** â†’ `docs/section2`  
            - ğŸ“ **section3** â†’ `docs/section3`
            - ğŸ“ **section4** â†’ `docs/section4`
            
            ### Action Features Used:
            - âœ… Parallel processing with matrix strategy
            - âœ… Smart comment creation/updating
            - âœ… Detailed linting results with expandable sections
            - âœ… Comprehensive error handling
            
            Check the individual section results above for detailed linting information.
            
            ---
            *Completed at ${{ github.event.head_commit.timestamp }}* | **Workflow:** `${{ github.workflow }}` | **Run:** [#${{ github.run_number }}](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})
